{% extends 'base.twig' %}

{% block title %}Paiement - Réservation #{{ reservationId }}{% endblock %}

{% block content %}
<script src="https://www.paypal.com/sdk/js?client-id=Aalf959gZW4hB3XcCv53HJIGH-03Vzai9ZCgtemgI7-zNimqzGOTpUBH65jGm52f3kLPmfGZOLTIVIyi&currency=USD"></script>

<div class="max-w-4xl mx-auto mt-12 bg-white shadow-xl rounded-lg p-8">
    <h1 class="text-3xl font-semibold text-gray-800 mb-6">Paiement de votre réservation</h1>
      
    <!-- Détails de la réservation -->
    <div class="mb-8">
        <h2 class="text-xl font-semibold text-gray-700 mb-4">Détails de la réservation</h2>
        <div class="space-y-4">
            <p><span class="font-semibold">Réservation # :</span> {{ reservationId }}</p>
            <p><span class="font-semibold">Date d'arrivée :</span> {{ reservation.datedebut }}</p>
            <p><span class="font-semibold">Date de départ :</span> {{ reservation.datefin }}</p>
            <p><span class="font-semibold">Nombre de chambres :</span> {{ reservation.voyageurs }}</p>
            <p><span class="font-semibold">Montant total :</span> {{ reservation.montant }} MAD</p>
        </div>
    </div>

    <!-- Options de paiement -->
    <div>
        <h2 class="text-xl font-semibold text-gray-700 mb-4">Choisissez votre mode de paiement</h2>

        <!-- Bouton PayPal -->
        <div class="mb-4">
            <div id="paypal-button-container"></div>
        </div>

        <!-- Option de paiement par carte (facultatif) -->
        <div>
            <button disabled class="bg-gray-300 text-gray-700 px-6 py-3 rounded-lg cursor-not-allowed flex items-center justify-center">
                <img src="https://upload.wikimedia.org/wikipedia/commons/5/5e/Visa_Inc._logo.svg" alt="Carte de crédit" class="h-6 mr-2">
                Payer par carte (bientôt disponible)
            </button>
        </div>
    </div>

    <!-- Message d'information -->
    <div class="mt-8 text-sm text-gray-500">
        <p>Vous serez redirigé vers PayPal pour finaliser votre paiement. Une fois le paiement confirmé, vous recevrez un e-mail de confirmation.</p>
    </div>
</div>
<link rel="stylesheet" href="https://cdn.pypal.com/css/styles.css">

<script>
    paypal.Buttons({
        createOrder: function(data, actions) {
            return actions.order.create({
                purchase_units: [{
                    amount: {
                        value: '{{ reservation.montant }}'
                    }
                }]
            });
        },
        onApprove: function(data, actions) {
            return actions.order.capture().then(function(details) {
                
                fetch('/process-transaction', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        orderID: data.orderID,
                        payerID: data.payerID
                    })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert('Transaction completed successfully!');
                    } else {
                        alert('Transaction failed.');
                    }
                });
            });
        }
    }).render('#paypal-button-container');
</script>
{% endblock %}